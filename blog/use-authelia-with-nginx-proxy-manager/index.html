<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">

<head>
	<title>Secure reverse proxy using Authelia and NGINX Proxy Manager and Docker - JNSN</title><meta name="gridsome:hash" content="ea117f9eaf93a10f57b7c08c27bee15658b6712f"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" data-key="description" name="description" content="My blog"><meta data-vue-tag="ssr" name="description" content="Setting up Authelia and NGINX Proxy Manager to add TOTP and password protection to your hosted services."><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.9fa61e47a9f4d108dd0cfb04ffb4f361.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.9fa61e47a9f4d108dd0cfb04ffb4f361.png"><link rel="preload" href="/assets/css/0.styles.99d85a46.css" as="style"><link rel="preload" href="/assets/js/app.9d85fadd.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.41560912.js" as="script"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.27be7686.js"><link rel="prefetch" href="/assets/js/page--src--pages--blog-vue.17641685.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.7c3aec96.js"><link rel="prefetch" href="/assets/js/page--src--pages--projects-vue.3ebc285b.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.c21c8015.js"><link rel="stylesheet" href="/assets/css/0.styles.99d85a46.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
</head>

<body >
	<div data-server-rendered="true" id="app" class="layout" data-v-107cb9bc><nav class="nav"><div class="container"><div class="brand"><a href="/" alt="JNSN" class="active"><img alt="JNSN" src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 135 38' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-06ad40579b0362537ddc3d0697e092c1'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-06ad40579b0362537ddc3d0697e092c1)' width='135' height='38' xlink:href='data:image/svg%2bxml%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAASCAYAAADrL9giAAAACXBIWXMAAAsTAAALEwEAmpwYAAADYUlEQVRYw71X7YuMURSf2Zkxdn1g8U1EbVjRlPUyXkpKCrEp%2bSJSSj5JMivt2hRi5aNv5G9Q3iKSDbvttot2SUvyZdEixbJrn5kd526/s/2cnmfmmczsrV935j7nnpffPefc54lEgkcV5g2CvCCLeQfJnMGaw2tBAutRkolh3gW5ccGoYD7ZUVuXIONBTpED3LPDkI3TvjTpdvNaY5t9miX4Qn6XhYARzOfIuVIIYF1ZCoSRo/UDxk6aiHNzt088FSVgjBSuMYEXI8CNFmPD4Q/0juG3JWQf7ecMUF9aDEkVJcAj9nuNniACFmC9RjBIDr1FCtcJlgrqBYsE2%2bC4kvGYbKwj3TnKmOUmlooSkCfnWn3qtBABA%2bTQ2QI%2b3SG5jgACOCOfTlUJeGRcG1cKMtOKEFCNU7cE1KCpJkjHfsFlwUXBwYASyBkSMpBJVJIAh%2beCu/S/M2QJzBC8p31XI%2bFHzBDg8Etwnf47IpZUugQcugQLBcOUDU0kuzOAABdEP2WSO8FrgvO4FtuAC4Irgi3YlyxwDbqAb5Fvj6aCgDdYO0LyLqAVWN9d4BZwMt9MHwnCOJGQMARo%2bi8WzCNC3dpRyM4VDDEBMaDqPwnopz0PaP0Z1hoDCNBrahmREASPAt3q0wM02Aasn6D1EdhMGjtly4A%2bqsk6BKkOHSI9loAoNTmXCafheAZwZXQcJTFMOj%2biUfItoM9S5GM7%2bXgbtv4pgb2CPYLNZSCAG9MxejaEQPS/LYGwo410fBbUhiCg3pTCKcE7JoBTmO9LJWBjiQSwjnY69R%2bUwrYEVgnWCzbhpUfrOw5Mx1oz2fuEhlaIAM2sk6YUflPDnFTYHXDFrDb1tz0EATGqa880sLy5BWYKvpJMxud7Qn9nSG4wBAHc1zrNQXpMgH7MNJsTrKa7fRRzYwgC2Okm6u5%2bBNSiKanzNwLSP4oaVnvfBbNDEKCHkSL7OSJiQhFvfinowb3%2bwVxNfWS0GAE8OszbGRPgxj1D8gAyshfoordF9eWmz6twUAboYbSSH5MEOOGfJi3y5qvMza8Ec0xtFSOA2c8XaIKuxp/4fFla6LOHpkTSIUpAR4%2bJa2KspKvBAztZIuQFnXyMAguTAXHTwILeA5L4wuMTYmjw98l%2bvAQCdE8DdE3I/gXUgDBSYL4i9AAAAABJRU5ErkJggg==' /%3e%3c/svg%3e" width="135" data-src="/assets/static/logo.9dd3765.a11581ea4b377049f7d94854a132ecde.svg" data-srcset="/assets/static/logo.9dd3765.a11581ea4b377049f7d94854a132ecde.svg 135w" data-sizes="(max-width: 135px) 100vw, 135px" class="g-image g-image--lazy g-image--loading"><noscript><img src="/assets/static/logo.9dd3765.a11581ea4b377049f7d94854a132ecde.svg" class="g-image g-image--loaded" width="135" alt="JNSN"></noscript></a></div><div id="menu"><div class="menu-item"><a href="/projects">Projects</a></div><div class="menu-item"><a href="/blog" class="active">Blog</a></div></div></div><svg viewBox="0 0 100 5" class="top-flourish"><polygon points="0,0 50,0 0,3"></polygon></svg></nav><main><div class="container" data-v-107cb9bc><div class="breadcrumbs" data-v-10ff4429 data-v-107cb9bc><span class="home" data-v-10ff4429>~/</span><span data-v-10ff4429><a href="/blog" class="active" data-v-10ff4429>blog</a><span class="separator" data-v-10ff4429>/</span></span><span data-v-10ff4429><a href="/use-authelia-with-nginx-proxy-manager" data-v-10ff4429>use-authelia-with-nginx-proxy-manager</a><span class="separator" data-v-10ff4429>/</span></span><span data-v-10ff4429></span></div><header data-v-107cb9bc><h1 class="title" data-v-107cb9bc>
				Secure reverse proxy using Authelia and NGINX Proxy Manager and Docker
			</h1><div class="tags" data-v-107cb9bc><a href="/blog/tag/authelia/" class="read-more-link" data-v-107cb9bc>authelia</a><a href="/blog/tag/nginx/" class="read-more-link" data-v-107cb9bc>nginx</a><a href="/blog/tag/docker/" class="read-more-link" data-v-107cb9bc>docker</a></div><div class="meta" data-v-107cb9bc><div class="meta-entry" data-v-107cb9bc>
					Posted August 17, 2021
				</div><div class="meta-entry" data-v-107cb9bc>
					Last Updated August 20, 2021
				</div></div></header><div class="content" data-v-107cb9bc><!----><div data-v-107cb9bc><p>NGINX Proxy Manager is a fantastic GUI frontend for NGINX that simplifies the process of adding and managing hosts, as well as generating SSL certificates using Let's Encrypt. It's a great way to organize local services across physical devices, containers, and virtual machines.</p>
<p>While NGINX Proxy Manager does protect itself with a username and password, the same may not be true for every given service you're proxying. Additionally, it (and most other services) will not offer any options for Two-Factor Authentication (2FA). Enter <a href="https://github.com/authelia/authelia" target="_blank" rel="nofollow noopener noreferrer">Authelia</a>.</p>
<blockquote>
<p>Authelia is an open-source authentication and authorization server providing two-factor authentication and single sign-on (SSO) for your applications via a web portal. It acts as a companion for reverse proxies like nginx, Traefik or HAProxy to let them know whether requests should either be allowed or redirected to Authelia's portal for authentication.</p>
</blockquote>
<p>This article assumes you have a reasonable familiarity with Docker, Docker Compose, NGINX, Let's Encrypt, and more. Basically, you need to know the specific things I know -- which isn't many things, but it is some things.</p>
<h2 id="setup"><a href="#setup" aria-hidden="true"><span class="icon icon-link"></span></a>Setup</h2>
<p>We'll be using <a href="https://docs.docker.com/compose/" target="_blank" rel="nofollow noopener noreferrer">docker-compose</a> for this setup, but this can of course be adapted to a variety of other configurations based on your needs. First, create a directory for this project:</p>
<div class="gridsome-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">mkdir</span> ~/nginx-proxy-manager
<span class="token builtin class-name">cd</span> ~/nginx-proxy-manager</code></pre></div>
<h3 id="secrets"><a href="#secrets" aria-hidden="true"><span class="icon icon-link"></span></a>Secrets</h3>
<p>Let's create a directory for our <strong>secrets</strong>. Docker secrets allow us to use sensitive data without entering it directly into our <code class="language-inline-text">docker-compose.yml</code>. Essentially, we will be mounting these files into our container where they can be read as environment variables by our <code class="language-inline-text">root</code> user.</p>
<div class="gridsome-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">mkdir</span> .secrets
<span class="token function">chmod</span> <span class="token number">700</span> .secrets</code></pre></div>
<p>Create the following <code class="language-inline-text">docker-compose.yml</code>:</p>
<div class="gridsome-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"2.1"</span>

<span class="token key atrule">secrets</span><span class="token punctuation">:</span>
  <span class="token key atrule">authelia_jwt_secret</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> .secrets/authelia_jwt_secret
  <span class="token key atrule">authelia_session_secret</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> .secrets/authelia_session_secret
  <span class="token key atrule">insecure_session_secret</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> .secrets/insecure_session_secret
  <span class="token key atrule">authelia_notifier_smtp_password</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> .secrets/authelia_notifier_smtp_password
  <span class="token key atrule">db_root_pwd</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> .secrets/db_root_pwd
  <span class="token key atrule">mysql_pwd</span><span class="token punctuation">:</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> .secrets/mysql_pwd

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">default</span><span class="token punctuation">:</span>
    <span class="token key atrule">external</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> proxy

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">npm</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>proxy<span class="token punctuation">-</span>manager
    <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">'jc21/nginx-proxy-manager:latest'</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">'80:80'</span>
      <span class="token punctuation">-</span> <span class="token string">'443:443'</span>
      <span class="token punctuation">-</span> <span class="token string">'81:81'</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">DB_MYSQL_HOST</span><span class="token punctuation">:</span> <span class="token string">"db"</span>
      <span class="token key atrule">DB_MYSQL_PORT</span><span class="token punctuation">:</span> <span class="token number">3306</span>
      <span class="token key atrule">DB_MYSQL_USER</span><span class="token punctuation">:</span> <span class="token string">"npm"</span>
      <span class="token key atrule">DB_MYSQL_PASSWORD__FILE</span><span class="token punctuation">:</span> /run/secrets/mysql_pwd
      <span class="token key atrule">DB_MYSQL_NAME</span><span class="token punctuation">:</span> <span class="token string">"npm"</span>
      <span class="token key atrule">DISABLE_IPV6</span><span class="token punctuation">:</span> <span class="token string">'true'</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./npm<span class="token punctuation">:</span>/data
      <span class="token punctuation">-</span> ./npm<span class="token punctuation">-</span>conf<span class="token punctuation">:</span>/data/nginx/custom
      <span class="token punctuation">-</span> ./letsencrypt<span class="token punctuation">:</span>/etc/letsencrypt
    <span class="token key atrule">secrets</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mysql_pwd
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> db

  <span class="token key atrule">db</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>db
    <span class="token key atrule">image</span><span class="token punctuation">:</span> jc21/mariadb<span class="token punctuation">-</span>aria
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD__FILE</span><span class="token punctuation">:</span> /run/secrets/db_root_pwd
      <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> <span class="token string">"npm"</span>
      <span class="token key atrule">MYSQL_USER</span><span class="token punctuation">:</span> <span class="token string">"npm"</span>
      <span class="token key atrule">MYSQL_PASSWORD__FILE</span><span class="token punctuation">:</span> /run/secrets/mysql_pwd
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./mysql<span class="token punctuation">:</span>/var/lib/mysql
    <span class="token key atrule">secrets</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> db_root_pwd
      <span class="token punctuation">-</span> mysql_pwd

  <span class="token key atrule">authelia</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> authelia/authelia<span class="token punctuation">:</span>latest
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> authelia
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> TZ=America/Vancouver
      <span class="token punctuation">-</span> AUTHELIA_JWT_SECRET_FILE=/run/secrets/authelia_jwt_secret
      <span class="token punctuation">-</span> AUTHELIA_SESSION_SECRET_FILE=/run/secrets/authelia_session_secret
      <span class="token punctuation">-</span> AUTHELIA_NOTIFIER_SMTP_PASSWORD_FILE=/run/secrets/authelia_notifier_smtp_password
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./authelia<span class="token punctuation">:</span>/config
    <span class="token key atrule">secrets</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> authelia_jwt_secret
      <span class="token punctuation">-</span> authelia_session_secret
      <span class="token punctuation">-</span> authelia_notifier_smtp_password
      <span class="token punctuation">-</span> insecure_session_secret
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped</code></pre></div>
<h2 id="nginx-proxy-manager"><a href="#nginx-proxy-manager" aria-hidden="true"><span class="icon icon-link"></span></a>NGINX Proxy Manager</h2>
<p>You'll need to create a Proxy Host for your Authelia instance. Create a new Proxy Host (e.g. <code class="language-inline-text">auth.example.com</code>) and point it to your Authelia host, port, and protocol in the Details tab. Then, add the following to the Custom Configuration block on the Advanced tab:</p>
<div class="gridsome-highlight" data-language="nginx"><pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$upstream_authelia</span> http://authelia:9091</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> <span class="token variable">$upstream_authelia</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_body_buffer_size</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>

    <span class="token comment">#Timeout if the real server is dead</span>
    <span class="token directive"><span class="token keyword">proxy_next_upstream</span> error timeout invalid_header http_500 http_502 http_503</span><span class="token punctuation">;</span>

    <span class="token comment"># Advanced Proxy Config</span>
    <span class="token directive"><span class="token keyword">send_timeout</span> <span class="token number">5m</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">360</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">360</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">360</span></span><span class="token punctuation">;</span>

    <span class="token comment"># Basic Proxy Config</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Proto <span class="token variable">$scheme</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Host <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Uri <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-Ssl <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_redirect</span>  http://  <span class="token variable">$scheme</span>://</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">""</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_cache_bypass</span> <span class="token variable">$cookie_session</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_no_cache</span> <span class="token variable">$cookie_session</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_buffers</span> <span class="token number">64</span> <span class="token number">256k</span></span><span class="token punctuation">;</span>

    <span class="token comment"># If behind reverse proxy, forwards the correct IP, assumes you're using Cloudflare. Adjust IP for your Docker network.</span>
    <span class="token directive"><span class="token keyword">set_real_ip_from</span> 172.19.0.0/16</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">real_ip_header</span> CF-Connecting-IP</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">real_ip_recursive</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Finally, you can add the following snippet in the Advanced tab for a Proxy Host to protect it with Authelia:</p>
<div class="gridsome-highlight" data-language="nginx"><pre class="language-nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">include</span> /data/nginx/custom/authelia-server.conf</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span> /data/nginx/custom/authelia-location.conf</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> <span class="token variable">$forward_scheme://</span><span class="token variable">$server</span>:<span class="token variable">$port</span></span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
</div></div></div></main></div>
	<script>window.__INITIAL_STATE__={"data":{"post":{"title":"Secure reverse proxy using Authelia and NGINX Proxy Manager and Docker","date_posted":"August 17, 2021","date_updated":"August 20, 2021","slug":"use-authelia-with-nginx-proxy-manager","path":"\u002Fblog\u002Fuse-authelia-with-nginx-proxy-manager\u002F","tags":[{"id":"authelia","title":"authelia","path":"\u002Fblog\u002Ftag\u002Fauthelia\u002F"},{"id":"nginx","title":"nginx","path":"\u002Fblog\u002Ftag\u002Fnginx\u002F"},{"id":"docker","title":"docker","path":"\u002Fblog\u002Ftag\u002Fdocker\u002F"}],"description":"Setting up Authelia and NGINX Proxy Manager to add TOTP and password protection to your hosted services.","content":"\u003Cp\u003ENGINX Proxy Manager is a fantastic GUI frontend for NGINX that simplifies the process of adding and managing hosts, as well as generating SSL certificates using Let's Encrypt. It's a great way to organize local services across physical devices, containers, and virtual machines.\u003C\u002Fp\u003E\n\u003Cp\u003EWhile NGINX Proxy Manager does protect itself with a username and password, the same may not be true for every given service you're proxying. Additionally, it (and most other services) will not offer any options for Two-Factor Authentication (2FA). Enter \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fauthelia\u002Fauthelia\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EAuthelia\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003EAuthelia is an open-source authentication and authorization server providing two-factor authentication and single sign-on (SSO) for your applications via a web portal. It acts as a companion for reverse proxies like nginx, Traefik or HAProxy to let them know whether requests should either be allowed or redirected to Authelia's portal for authentication.\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003EThis article assumes you have a reasonable familiarity with Docker, Docker Compose, NGINX, Let's Encrypt, and more. Basically, you need to know the specific things I know -- which isn't many things, but it is some things.\u003C\u002Fp\u003E\n\u003Ch2 id=\"setup\"\u003E\u003Ca href=\"#setup\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ESetup\u003C\u002Fh2\u003E\n\u003Cp\u003EWe'll be using \u003Ca href=\"https:\u002F\u002Fdocs.docker.com\u002Fcompose\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Edocker-compose\u003C\u002Fa\u003E for this setup, but this can of course be adapted to a variety of other configurations based on your needs. First, create a directory for this project:\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"bash\"\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E\u003Cspan class=\"token function\"\u003Emkdir\u003C\u002Fspan\u003E ~\u002Fnginx-proxy-manager\n\u003Cspan class=\"token builtin class-name\"\u003Ecd\u003C\u002Fspan\u003E ~\u002Fnginx-proxy-manager\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Ch3 id=\"secrets\"\u003E\u003Ca href=\"#secrets\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ESecrets\u003C\u002Fh3\u003E\n\u003Cp\u003ELet's create a directory for our \u003Cstrong\u003Esecrets\u003C\u002Fstrong\u003E. Docker secrets allow us to use sensitive data without entering it directly into our \u003Ccode class=\"language-inline-text\"\u003Edocker-compose.yml\u003C\u002Fcode\u003E. Essentially, we will be mounting these files into our container where they can be read as environment variables by our \u003Ccode class=\"language-inline-text\"\u003Eroot\u003C\u002Fcode\u003E user.\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"bash\"\u003E\u003Cpre class=\"language-bash\"\u003E\u003Ccode class=\"language-bash\"\u003E\u003Cspan class=\"token function\"\u003Emkdir\u003C\u002Fspan\u003E .secrets\n\u003Cspan class=\"token function\"\u003Echmod\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E700\u003C\u002Fspan\u003E .secrets\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003ECreate the following \u003Ccode class=\"language-inline-text\"\u003Edocker-compose.yml\u003C\u002Fcode\u003E:\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"yaml\"\u003E\u003Cpre class=\"language-yaml\"\u003E\u003Ccode class=\"language-yaml\"\u003E\u003Cspan class=\"token key atrule\"\u003Eversion\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"2.1\"\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token key atrule\"\u003Esecrets\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token key atrule\"\u003Eauthelia_jwt_secret\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Efile\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E .secrets\u002Fauthelia_jwt_secret\n  \u003Cspan class=\"token key atrule\"\u003Eauthelia_session_secret\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Efile\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E .secrets\u002Fauthelia_session_secret\n  \u003Cspan class=\"token key atrule\"\u003Einsecure_session_secret\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Efile\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E .secrets\u002Finsecure_session_secret\n  \u003Cspan class=\"token key atrule\"\u003Eauthelia_notifier_smtp_password\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Efile\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E .secrets\u002Fauthelia_notifier_smtp_password\n  \u003Cspan class=\"token key atrule\"\u003Edb_root_pwd\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Efile\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E .secrets\u002Fdb_root_pwd\n  \u003Cspan class=\"token key atrule\"\u003Emysql_pwd\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Efile\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E .secrets\u002Fmysql_pwd\n\n\u003Cspan class=\"token key atrule\"\u003Enetworks\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token key atrule\"\u003Edefault\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Eexternal\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token key atrule\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E proxy\n\n\u003Cspan class=\"token key atrule\"\u003Eservices\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token key atrule\"\u003Enpm\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Econtainer_name\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E nginx\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Eproxy\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Emanager\n    \u003Cspan class=\"token key atrule\"\u003Eimage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'jc21\u002Fnginx-proxy-manager:latest'\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Erestart\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E unless\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Estopped\n    \u003Cspan class=\"token key atrule\"\u003Eports\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'80:80'\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'443:443'\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'81:81'\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Eenvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token key atrule\"\u003EDB_MYSQL_HOST\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"db\"\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token key atrule\"\u003EDB_MYSQL_PORT\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E3306\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token key atrule\"\u003EDB_MYSQL_USER\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"npm\"\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token key atrule\"\u003EDB_MYSQL_PASSWORD__FILE\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u002Frun\u002Fsecrets\u002Fmysql_pwd\n      \u003Cspan class=\"token key atrule\"\u003EDB_MYSQL_NAME\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"npm\"\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token key atrule\"\u003EDISABLE_IPV6\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'true'\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Evolumes\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E .\u002Fnpm\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\u002Fdata\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E .\u002Fnpm\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Econf\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\u002Fdata\u002Fnginx\u002Fcustom\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E .\u002Fletsencrypt\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\u002Fetc\u002Fletsencrypt\n    \u003Cspan class=\"token key atrule\"\u003Esecrets\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E mysql_pwd\n    \u003Cspan class=\"token key atrule\"\u003Edepends_on\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E db\n\n  \u003Cspan class=\"token key atrule\"\u003Edb\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Econtainer_name\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E nginx\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Edb\n    \u003Cspan class=\"token key atrule\"\u003Eimage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E jc21\u002Fmariadb\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Earia\n    \u003Cspan class=\"token key atrule\"\u003Erestart\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E unless\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Estopped\n    \u003Cspan class=\"token key atrule\"\u003Eenvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token key atrule\"\u003EMYSQL_ROOT_PASSWORD__FILE\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u002Frun\u002Fsecrets\u002Fdb_root_pwd\n      \u003Cspan class=\"token key atrule\"\u003EMYSQL_DATABASE\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"npm\"\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token key atrule\"\u003EMYSQL_USER\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"npm\"\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token key atrule\"\u003EMYSQL_PASSWORD__FILE\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u002Frun\u002Fsecrets\u002Fmysql_pwd\n    \u003Cspan class=\"token key atrule\"\u003Evolumes\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E .\u002Fmysql\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\u002Fvar\u002Flib\u002Fmysql\n    \u003Cspan class=\"token key atrule\"\u003Esecrets\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n          \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E db_root_pwd\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E mysql_pwd\n\n  \u003Cspan class=\"token key atrule\"\u003Eauthelia\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token key atrule\"\u003Eimage\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E authelia\u002Fauthelia\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003Elatest\n    \u003Cspan class=\"token key atrule\"\u003Econtainer_name\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E authelia\n    \u003Cspan class=\"token key atrule\"\u003Eenvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E TZ=America\u002FVancouver\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E AUTHELIA_JWT_SECRET_FILE=\u002Frun\u002Fsecrets\u002Fauthelia_jwt_secret\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E AUTHELIA_SESSION_SECRET_FILE=\u002Frun\u002Fsecrets\u002Fauthelia_session_secret\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E AUTHELIA_NOTIFIER_SMTP_PASSWORD_FILE=\u002Frun\u002Fsecrets\u002Fauthelia_notifier_smtp_password\n    \u003Cspan class=\"token key atrule\"\u003Evolumes\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E .\u002Fauthelia\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\u002Fconfig\n    \u003Cspan class=\"token key atrule\"\u003Esecrets\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E authelia_jwt_secret\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E authelia_session_secret\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E authelia_notifier_smtp_password\n      \u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003E insecure_session_secret\n    \u003Cspan class=\"token key atrule\"\u003Erestart\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E unless\u003Cspan class=\"token punctuation\"\u003E-\u003C\u002Fspan\u003Estopped\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Ch2 id=\"nginx-proxy-manager\"\u003E\u003Ca href=\"#nginx-proxy-manager\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ENGINX Proxy Manager\u003C\u002Fh2\u003E\n\u003Cp\u003EYou'll need to create a Proxy Host for your Authelia instance. Create a new Proxy Host (e.g. \u003Ccode class=\"language-inline-text\"\u003Eauth.example.com\u003C\u002Fcode\u003E) and point it to your Authelia host, port, and protocol in the Details tab. Then, add the following to the Custom Configuration block on the Advanced tab:\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"nginx\"\u003E\u003Cpre class=\"language-nginx\"\u003E\u003Ccode class=\"language-nginx\"\u003E\u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Elocation\u003C\u002Fspan\u003E \u002F\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eset\u003C\u002Fspan\u003E \u003Cspan class=\"token variable\"\u003E$upstream_authelia\u003C\u002Fspan\u003E http:\u002F\u002Fauthelia:9091\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_pass\u003C\u002Fspan\u003E \u003Cspan class=\"token variable\"\u003E$upstream_authelia\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eclient_body_buffer_size\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E128k\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"token comment\"\u003E#Timeout if the real server is dead\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_next_upstream\u003C\u002Fspan\u003E error timeout invalid_header http_500 http_502 http_503\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"token comment\"\u003E# Advanced Proxy Config\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Esend_timeout\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E5m\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_read_timeout\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E360\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_send_timeout\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E360\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_connect_timeout\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E360\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"token comment\"\u003E# Basic Proxy Config\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_set_header\u003C\u002Fspan\u003E Host \u003Cspan class=\"token variable\"\u003E$host\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_set_header\u003C\u002Fspan\u003E X-Real-IP \u003Cspan class=\"token variable\"\u003E$remote_addr\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_set_header\u003C\u002Fspan\u003E X-Forwarded-For \u003Cspan class=\"token variable\"\u003E$proxy_add_x_forwarded_for\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_set_header\u003C\u002Fspan\u003E X-Forwarded-Proto \u003Cspan class=\"token variable\"\u003E$scheme\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_set_header\u003C\u002Fspan\u003E X-Forwarded-Host \u003Cspan class=\"token variable\"\u003E$http_host\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_set_header\u003C\u002Fspan\u003E X-Forwarded-Uri \u003Cspan class=\"token variable\"\u003E$request_uri\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_set_header\u003C\u002Fspan\u003E X-Forwarded-Ssl \u003Cspan class=\"token boolean\"\u003Eon\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_redirect\u003C\u002Fspan\u003E  http:\u002F\u002F  \u003Cspan class=\"token variable\"\u003E$scheme\u003C\u002Fspan\u003E:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_http_version\u003C\u002Fspan\u003E 1.1\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_set_header\u003C\u002Fspan\u003E Connection \u003Cspan class=\"token string\"\u003E\"\"\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_cache_bypass\u003C\u002Fspan\u003E \u003Cspan class=\"token variable\"\u003E$cookie_session\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_no_cache\u003C\u002Fspan\u003E \u003Cspan class=\"token variable\"\u003E$cookie_session\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_buffers\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E64\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E256k\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"token comment\"\u003E# If behind reverse proxy, forwards the correct IP, assumes you're using Cloudflare. Adjust IP for your Docker network.\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eset_real_ip_from\u003C\u002Fspan\u003E 172.19.0.0\u002F16\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Ereal_ip_header\u003C\u002Fspan\u003E CF-Connecting-IP\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Ereal_ip_recursive\u003C\u002Fspan\u003E \u003Cspan class=\"token boolean\"\u003Eon\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n\u003Cp\u003EFinally, you can add the following snippet in the Advanced tab for a Proxy Host to protect it with Authelia:\u003C\u002Fp\u003E\n\u003Cdiv class=\"gridsome-highlight\" data-language=\"nginx\"\u003E\u003Cpre class=\"language-nginx\"\u003E\u003Ccode class=\"language-nginx\"\u003E\u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Einclude\u003C\u002Fspan\u003E \u002Fdata\u002Fnginx\u002Fcustom\u002Fauthelia-server.conf\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Elocation\u003C\u002Fspan\u003E \u002F\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Einclude\u003C\u002Fspan\u003E \u002Fdata\u002Fnginx\u002Fcustom\u002Fauthelia-location.conf\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token directive\"\u003E\u003Cspan class=\"token keyword\"\u003Eproxy_pass\u003C\u002Fspan\u003E \u003Cspan class=\"token variable\"\u003E$forward_scheme:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"token variable\"\u003E$server\u003C\u002Fspan\u003E:\u003Cspan class=\"token variable\"\u003E$port\u003C\u002Fspan\u003E\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n","fileInfo":{"name":"2021-08-17-use-authelia-with-nginx-proxy-manager"}}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.9d85fadd.js" defer></script><script src="/assets/js/page--src--templates--post-vue.41560912.js" defer></script>
</body>

</html>